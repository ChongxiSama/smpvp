<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>玩家状态</title>
  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: monospace, monospace;
      font-size: 5vw;
      max-width: 600px;
      margin: 2em auto;
      padding: 1em;
      text-align: center;
    }
    .label {
      font-weight: bold;
      margin-top: 1em;
    }
    #timer, #currentTime {
      margin-top: 1em;
      font-size: 4vw;
    }
  </style>
</head>
<body>
  <h1>玩家状态</h1>
  <div><span class="label">编号：</span><span id="token">加载中...</span></div>
  <div><span class="label">资金：</span><span id="money">加载中...</span></div>
  <div><span class="label">血量：</span>
    <span id="hp-head">-</span> /
    <span id="hp-chest">-</span> /
    <span id="hp-back">-</span>
  </div>

  <div id="currentTime" aria-live="polite">当前时间：--:--:--</div>
  <div id="timer" aria-live="polite">剩余时间：--:--</div>

  <script>
    const token = localStorage.getItem("player_token");
    if (!token) {
      alert("未注册，请先访问注册页面");
      location.href = "/register.html";
    } else {
      document.getElementById("token").innerText = token;
      fetch(`https://scan.chongxi.us/status?token=${encodeURIComponent(token)}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            alert("获取玩家状态失败：" + data.error);
            return;
          }
          document.getElementById("money").innerText = (data.money / 10000).toFixed(2) + " 万";
          document.getElementById("hp-head").innerText = data.hp.head;
          document.getElementById("hp-chest").innerText = data.hp.chest;
          document.getElementById("hp-back").innerText = data.hp.back;
        })
        .catch(err => {
          alert("网络错误：" + err.message);
        });
    }

    // 游戏起始时间，按需修改
    const gameStartTime = new Date("2025-08-04T16:20:00");
    const gameDurationMinutes = 60;
    const gameEndTime = new Date(gameStartTime.getTime() + gameDurationMinutes * 60 * 1000);

    function pad(num) {
      return num.toString().padStart(2, "0");
    }

    function updateTimes() {
      const now = new Date();

      // 当前时间
      const h = pad(now.getHours());
      const m = pad(now.getMinutes());
      const s = pad(now.getSeconds());
      document.getElementById("currentTime").innerText = `当前时间：${h}:${m}:${s}`;

      // 剩余时间
      let remainingMs = gameEndTime - now;
      if (remainingMs < 0) remainingMs = 0;
      const mins = pad(Math.floor(remainingMs / 60000));
      const secs = pad(Math.floor((remainingMs % 60000) / 1000));
      document.getElementById("timer").innerText = `剩余时间：${mins}:${secs}`;
    }

    updateTimes();
    setInterval(updateTimes, 1000);
  </script>
</body>
</html>
